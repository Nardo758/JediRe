Leon AI Assistant, [2/19/2026 7:46 PM]
Perfect! Here are the files to paste into Replit:


üìÑ FILE 1: Migration SQL

Create: backend/src/database/migrations/040_property_records.sql

-- Migration 040: Property Records & Sales History
-- Stores scraped property data from county APIs for market research

-- Property records table (main property data)
CREATE TABLE IF NOT EXISTS property_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- Identification
  parcel_id TEXT NOT NULL UNIQUE,
  county TEXT NOT NULL DEFAULT 'Fulton',
  state TEXT NOT NULL DEFAULT 'GA',
  
  -- Address
  address TEXT NOT NULL,
  city TEXT,
  zip_code TEXT,
  
  -- Owner Information
  owner_name TEXT,
  owner_address_1 TEXT,
  owner_address_2 TEXT,
  
  -- Property Characteristics
  units INTEGER,
  land_acres DECIMAL(10, 4),
  year_built TEXT,
  stories INTEGER,
  building_sqft DECIMAL(12, 2),
  
  -- Valuation (current year)
  assessed_value BIGINT,
  assessed_land BIGINT,
  assessed_improvements BIGINT,
  appraised_value BIGINT,
  appraised_land BIGINT,
  appraised_improvements BIGINT,
  
  -- Classification
  land_use_code TEXT,
  class_code TEXT,
  neighborhood_code TEXT,
  subdivision TEXT,
  tax_district TEXT,
  
  -- GIS Data
  parcel_area_sqft DECIMAL(12, 2),
  parcel_perimeter_ft DECIMAL(12, 2),
  
  -- Metadata
  tax_year INTEGER DEFAULT 2025,
  data_source_url TEXT,
  scraped_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Sales history table
CREATE TABLE IF NOT EXISTS property_sales (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  parcel_id TEXT NOT NULL REFERENCES property_records(parcel_id) ON DELETE CASCADE,
  
  -- Sale Details
  sale_year INTEGER NOT NULL,
  sale_price BIGINT NOT NULL,
  
  -- Metadata
  is_current BOOLEAN DEFAULT true,
  scraped_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  
  UNIQUE(parcel_id, sale_year)
);

-- Market trends table (city-level median prices)
CREATE TABLE IF NOT EXISTS market_trends (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  city TEXT NOT NULL,
  year INTEGER NOT NULL,
  median_sale_price BIGINT,
  
  -- Metadata
  scraped_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  
  UNIQUE(city, year)
);

-- Indexes for performance
CREATE INDEX IF NOT EXISTS idx_property_records_parcel_id ON property_records(parcel_id);
CREATE INDEX IF NOT EXISTS idx_property_records_units ON property_records(units);
CREATE INDEX IF NOT EXISTS idx_property_records_county ON property_records(county);
CREATE INDEX IF NOT EXISTS idx_property_records_address ON property_records(address);
CREATE INDEX IF NOT EXISTS idx_property_records_owner ON property_records(owner_name);
CREATE INDEX IF NOT EXISTS idx_property_records_appraised ON property_records(appraised_value);
CREATE INDEX IF NOT EXISTS idx_property_records_neighborhood ON property_records(neighborhood_code);

CREATE INDEX IF NOT EXISTS idx_property_sales_parcel_id ON property_sales(parcel_id);
CREATE INDEX IF NOT EXISTS idx_property_sales_year ON property_sales(sale_year);
CREATE INDEX IF NOT EXISTS idx_property_sales_price ON property_sales(sale_price);

CREATE INDEX IF NOT EXISTS idx_market_trends_city ON market_trends(city);
CREATE INDEX IF NOT EXISTS idx_market_trends_year ON market_trends(year);

-- Computed columns (per-unit metrics)
CREATE OR REPLACE VIEW property_metrics AS
SELECT 
  pr.*,
  CASE 
    WHEN pr.units > 0 THEN pr.assessed_value / pr.units 
    ELSE NULL 
  END AS assessed_per_unit,
  CASE 
    WHEN pr.units > 0 THEN pr.appraised_value / pr.units 
    ELSE NULL 
  END AS appraised_per_unit,
  CASE 
    WHEN pr.units > 0 THEN pr.land_acres / pr.units 
    ELSE NULL 
  END AS acres_per_unit,
  CASE 
    WHEN pr.units > 0 AND pr.building_sqft > 0 THEN pr.building_sqft / pr.units 
    ELSE NULL 
  END AS sqft_per_unit
FROM property_records pr;

-- Grant permissions

Leon AI Assistant, [2/19/2026 7:46 PM]
GRANT SELECT, INSERT, UPDATE, DELETE ON property_records TO authenticated;
GRANT SELECT, INSERT, UPDATE, DELETE ON property_sales TO authenticated;
GRANT SELECT, INSERT, UPDATE, DELETE ON market_trends TO authenticated;
GRANT SELECT ON property_metrics TO authenticated;

COMMENT ON TABLE property_records IS 'Property data scraped from county assessor APIs';
COMMENT ON TABLE property_sales IS 'Sales history for properties (2018-2022)';
COMMENT ON TABLE market_trends IS 'City-level median sale prices (2012-2024) for market context';
COMMENT ON COLUMN property_records.units IS 'Number of living units - critical for multifamily analysis';
COMMENT ON COLUMN property_records.appraised_value IS 'Total appraised value (typically higher than assessed)';
COMMENT ON COLUMN property_records.assessed_value IS 'Total assessed value (used for tax calculation)';


Now run the migration:

cd ~/workspace/jedire
psql $DATABASE_URL -f backend/src/database/migrations/040_property_records.sql


I'll send the import script TypeScript file in the next message (it's long). Ready? üöÄ

Leon AI Assistant, [2/19/2026 7:47 PM]
üìÑ FILE 2: Import Script TypeScript

Create: backend/src/scripts/import-fulton-properties.ts

#!/usr/bin/env tsx
/**
 * Import Fulton County Properties (100+ units)
 * 
 * Queries 3 Fulton County APIs:
 * 1. Tax_Parcels_2025 - Property details & valuations
 * 2. Tyler_YearlySales - Sales history (2018-2022)
 * 3. CommissionDistrict1Cities_HomeSales - Market trends (2012-2024)
 * 
 * Usage: tsx import-fulton-properties.ts
 */

import { Pool } from 'pg';
import 'dotenv/config';

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});

// Fulton County API endpoints
const API_BASE = 'https://services1.arcgis.com/AQDHTHDrZzfsFsB5/ArcGIS/rest/services';
const TAX_PARCELS = `${API_BASE}/Tax_Parcels_2025/FeatureServer/0`;
const SALES_BASE = `${API_BASE}/Tyler_YearlySales/FeatureServer`;
const STRUCTURES = `${API_BASE}/Structures/FeatureServer/0`;
const MARKET_TRENDS = `${API_BASE}/CommissionDistrict1Cities_HomeSales/FeatureServer/28`;

interface TaxParcelFeature {
  attributes: {
    ParcelID: string;
    Address: string;
    Owner: string;
    OwnerAddr1: string;
    OwnerAddr2: string;
    LivUnits: number;
    LandAcres: number;
    TotAssess: number;
    LandAssess: number;
    ImprAssess: number;
    TotAppr: number;
    LandAppr: number;
    ImprAppr: number;
    LUCode: string;
    ClassCode: string;
    NbrHood: string;
    Subdiv: string;
    TaxDist: string;
    TaxYear: number;
    Shape__Area: number;
    Shape__Length: number;
  };
}

interface SaleFeature {
  attributes: {
    ParID: string;
    TaxYear: string;
    Price: number;
    Cur: string;
  };
}

interface StructureFeature {
  attributes: {
    FeatureID: string;
    YearBuilt: string;
    Stories: number;
    LiveUnits: number;
    AreaSqFt: number;
    StructForm: string;
  };
}

interface MarketTrendFeature {
  attributes: {
    City: string;
    F2012_avg_median_sale_price: number;
    F2013_avg_median_sale_price: number;
    F2014_avg_median_sale_price: number;
    F2015_avg_median_sale_price: number;
    F2016_avg_median_sale_price: number;
    F2017_avg_median_sale_price: number;
    F2018_avg_median_sale_price: number;
    F2019_avg_median_sale_price: number;
    F2020_avg_median_sale_price: number;
    F2021_avg_median_sale_price: number;
    F2022_avg_median_sale_price: number;
    F2023_avg_median_sale_price: number;
    F2024_avg_median_sale_price: number;
  };
}

/**
 * Fetch properties with 100+ units from Tax Parcels API
 */
async function fetchLargeMultifamilyProperties(): Promise<TaxParcelFeature[]> {
  console.log('üîç Querying Tax Parcels API for 100+ unit properties...');
  
  const url = `${TAX_PARCELS}/query`;
  const params = new URLSearchParams({
    where: 'LivUnits >= 100',
    outFields: '*',
    f: 'json',
    returnGeometry: 'false',
    resultRecordCount: '1000',
  });
  
  const response = await fetch(`${url}?${params}`);
  const data = await response.json();
  
  if (data.features) {
    console.log(`‚úÖ Found ${data.features.length} properties with 100+ units`);
    return data.features;
  }
  
  console.error('‚ùå No properties found or API error:', data.error);
  return [];
}

/**
 * Fetch sales history for a parcel (2018-2022)
 */
async function fetchSalesHistory(parcelId: string): Promise<SaleFeature[]> {
  const allSales: SaleFeature[] = [];
  
  // Query each year (layers 2-6 = 2018-2022)
  for (let year = 2018; year <= 2022; year++) {
    const layerId = year - 2016;
    
    const url = `${SALES_BASE}/${layerId}/query`;
    const params = new URLSearchParams({
      where: `ParID='${parcelId}'`,
      outFields: '*',
      f: 'json',
      returnGeometry: 'false',
    });
    
    try {
      const response = await fetch(`${url}?${params}`);
      const data = await response.json();
      
      if (data.features && data.features.length > 0) {
        allSales.push(...data.features);
      }
    } catch (error) {
      console.error(`  ‚ö†Ô∏è  Error fetching ${year} sales for ${parcelId}:`, error);
    }
  }

Leon AI Assistant, [2/19/2026 7:47 PM]
return allSales;
}

/**
 * Fetch building details from Structures API
 */
async function fetchStructureData(parcelId: string): Promise<StructureFeature | null> {
  return null;
}

/**
 * Fetch market trends (city median prices 2012-2024)
 */
async function fetchMarketTrends(): Promise<MarketTrendFeature[]> {
  console.log('üîç Querying market trends (city median prices 2012-2024)...');
  
  const url = `${MARKET_TRENDS}/query`;
  const params = new URLSearchParams({
    where: '1=1',
    outFields: '*',
    f: 'json',
    returnGeometry: 'false',
  });
  
  const response = await fetch(`${url}?${params}`);
  const data = await response.json();
  
  if (data.features) {
    console.log(`‚úÖ Found market data for ${data.features.length} cities`);
    return data.features;
  }
  
  console.error('‚ùå No market trends found');
  return [];
}

/**
 * Insert or update property record
 */
async function upsertPropertyRecord(feature: TaxParcelFeature): Promise<void> {
  const attrs = feature.attributes;
  
  const query = `
    INSERT INTO property_records (
      parcel_id, county, state, address, owner_name, owner_address_1, owner_address_2,
      units, land_acres, assessed_value, assessed_land, assessed_improvements,
      appraised_value, appraised_land, appraised_improvements, land_use_code,
      class_code, neighborhood_code, subdivision, tax_district,
      parcel_area_sqft, parcel_perimeter_ft, tax_year, data_source_url,
      scraped_at, updated_at
    ) VALUES (
      $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15,
      $16, $17, $18, $19, $20, $21, $22, $23, $24, NOW(), NOW()
    )
    ON CONFLICT (parcel_id) DO UPDATE SET
      address = EXCLUDED.address,
      owner_name = EXCLUDED.owner_name,
      owner_address_1 = EXCLUDED.owner_address_1,
      owner_address_2 = EXCLUDED.owner_address_2,
      units = EXCLUDED.units,
      land_acres = EXCLUDED.land_acres,
      assessed_value = EXCLUDED.assessed_value,
      assessed_land = EXCLUDED.assessed_land,
      assessed_improvements = EXCLUDED.assessed_improvements,
      appraised_value = EXCLUDED.appraised_value,
      appraised_land = EXCLUDED.appraised_land,
      appraised_improvements = EXCLUDED.appraised_improvements,
      land_use_code = EXCLUDED.land_use_code,
      class_code = EXCLUDED.class_code,
      neighborhood_code = EXCLUDED.neighborhood_code,
      subdivision = EXCLUDED.subdivision,
      tax_district = EXCLUDED.tax_district,
      parcel_area_sqft = EXCLUDED.parcel_area_sqft,
      parcel_perimeter_ft = EXCLUDED.parcel_perimeter_ft,
      tax_year = EXCLUDED.tax_year,
      data_source_url = EXCLUDED.data_source_url,
      updated_at = NOW()
  `;
  
  const values = [
    attrs.ParcelID,
    'Fulton',
    'GA',
    attrs.Address || '',
    attrs.Owner || null,
    attrs.OwnerAddr1 || null,
    attrs.OwnerAddr2 || null,
    attrs.LivUnits || null,
    attrs.LandAcres || null,
    attrs.TotAssess || null,
    attrs.LandAssess || null,
    attrs.ImprAssess || null,
    attrs.TotAppr || null,
    attrs.LandAppr || null,
    attrs.ImprAppr || null,
    attrs.LUCode || null,
    attrs.ClassCode || null,
    attrs.NbrHood || null,
    attrs.Subdiv || null,
    attrs.TaxDist || null,
    attrs.Shape__Area || null,
    attrs.Shape__Length || null,
    attrs.TaxYear || 2025,
    `${TAX_PARCELS}/query?where=ParcelID='${encodeURIComponent(attrs.ParcelID)}'`,
  ];
  
  try {
    await pool.query(query, values);
  } catch (error: any) {
    console.error(`  ‚ùå Error upserting ${attrs.ParcelID}:`, error.message);
  }
}

/**
 * Insert sales records
 */
async function insertSalesRecords(parcelId: string, sales: SaleFeature[]): Promise<void> {
  if (sales.length === 0) return;
  
  const realSales = sales.filter(s => s.attributes.Price > 0);
  
  if (realSales.length === 0) return;
  
  const query = `
    INSERT INTO property_sales (
      parcel_id, sale_year, sale_price, is_current, scraped_at
    ) VALUES ($1, $2, $3, $4, NOW())

Leon AI Assistant, [2/19/2026 7:47 PM]
ON CONFLICT (parcel_id, sale_year) DO UPDATE SET
      sale_price = EXCLUDED.sale_price,
      is_current = EXCLUDED.is_current
  `;
  
  try {
    for (const sale of realSales) {
      const values = [
        parcelId,
        parseInt(sale.attributes.TaxYear),
        sale.attributes.Price,
        sale.attributes.Cur === 'Y',
      ];
      
      await pool.query(query, values);
    }
  } catch (error: any) {
    console.error(`  ‚ùå Error inserting sales for ${parcelId}:`, error.message);
  }
}

/**
 * Insert market trends (city median prices)
 */
async function insertMarketTrends(trends: MarketTrendFeature[]): Promise<number> {
  let count = 0;
  
  const query = `
    INSERT INTO market_trends (city, year, median_sale_price, scraped_at)
    VALUES ($1, $2, $3, NOW())
    ON CONFLICT (city, year) DO UPDATE SET
      median_sale_price = EXCLUDED.median_sale_price
  `;
  
  for (const trend of trends) {
    const attrs = trend.attributes;
    const city = attrs.City;
    
    const yearData = [
      { year: 2012, price: attrs.F2012_avg_median_sale_price },
      { year: 2013, price: attrs.F2013_avg_median_sale_price },
      { year: 2014, price: attrs.F2014_avg_median_sale_price },
      { year: 2015, price: attrs.F2015_avg_median_sale_price },
      { year: 2016, price: attrs.F2016_avg_median_sale_price },
      { year: 2017, price: attrs.F2017_avg_median_sale_price },
      { year: 2018, price: attrs.F2018_avg_median_sale_price },
      { year: 2019, price: attrs.F2019_avg_median_sale_price },
      { year: 2020, price: attrs.F2020_avg_median_sale_price },
      { year: 2021, price: attrs.F2021_avg_median_sale_price },
      { year: 2022, price: attrs.F2022_avg_median_sale_price },
      { year: 2023, price: attrs.F2023_avg_median_sale_price },
      { year: 2024, price: attrs.F2024_avg_median_sale_price },
    ];
    
    try {
      for (const { year, price } of yearData) {
        if (price && price > 0) {
          await pool.query(query, [city, year, Math.round(price)]);
          count++;
        }
      }
    } catch (error: any) {
      console.error(`  ‚ùå Error inserting trends for ${city}:`, error.message);
    }
  }
  
  return count;
}

/**
 * Main import function
 */
async function importProperties() {
  console.log('üöÄ Starting Fulton County Property Import (100+ units)');
  console.log('‚îÅ'.repeat(80));
  console.log('');
  
  const properties = await fetchLargeMultifamilyProperties();
  
  if (properties.length === 0) {
    console.log('‚ùå No properties found. Exiting.');
    return;
  }
  
  console.log('');
  console.log('‚îÅ'.repeat(80));
  console.log('üì• Importing properties into database...');
  console.log('‚îÅ'.repeat(80));
  console.log('');
  
  let successCount = 0;
  let salesCount = 0;
  
  for (let i = 0; i < properties.length; i++) {
    const property = properties[i];
    const parcelId = property.attributes.ParcelID;
    const address = property.attributes.Address;
    const units = property.attributes.LivUnits;
    
    console.log(`[${i + 1}/${properties.length}] ${address} (${units} units, ${parcelId})`);
    
    try {
      await upsertPropertyRecord(property);
      successCount++;
      
      const sales = await fetchSalesHistory(parcelId);
      if (sales.length > 0) {
        await insertSalesRecords(parcelId, sales);
        const realSales = sales.filter(s => s.attributes.Price > 0);
        if (realSales.length > 0) {
          console.log(`  üí∞ Found ${realSales.length} sale(s)`);
          salesCount += realSales.length;
        }
      }
      
      await new Promise(resolve => setTimeout(resolve, 100));
      
    } catch (error) {
      console.error(`  ‚ùå Error processing ${parcelId}:`, error);
    }
  }
  
  console.log('');
  console.log('‚îÅ'.repeat(80));
  console.log('üìà Importing market trends (city median prices)...');
  console.log('‚îÅ'.repeat(80));
  console.log('');
  
  const marketData = await fetchMarketTrends();
  let trendsCount = 0;

Leon AI Assistant, [2/19/2026 7:47 PM]
if (marketData.length > 0) {
    trendsCount = await insertMarketTrends(marketData);
    console.log(`‚úÖ Imported ${trendsCount} market trend records`);
  }
  
  console.log('');
  console.log('‚îÅ'.repeat(80));
  console.log('‚úÖ Import Complete!');
  console.log('‚îÅ'.repeat(80));
  console.log('');
  console.log(`üìä Summary:`);
  console.log(`   Properties imported: ${successCount}/${properties.length}`);
  console.log(`   Sales records: ${salesCount}`);
  console.log(`   Market trends: ${trendsCount} data points (${marketData.length} cities, 2012-2024)`);
  console.log('');
  console.log('üéØ Next steps:');
  console.log('   1. Check property_records table');
  console.log('   2. Check property_sales table for sales history');
  console.log('   3. Check market_trends table for city-level context');
  console.log('   4. Query property_metrics view for per-unit calculations');
  console.log('');
}

importProperties()
  .then(async () => {
    console.log('‚ú® Done!');
    await pool.end();
    process.exit(0);
  })
  .catch(async (error) => {
    console.error('üí• Fatal error:', error);
    await pool.end();
    process.exit(1);
  });


Now run these commands in Replit:

cd ~/workspace/jedire/backend
npm install pg
tsx src/scripts/import-fulton-properties.ts

This will take ~5-10 minutes. You'll see property imports, sales history, and market trends! üöÄ