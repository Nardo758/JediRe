Leon AI Assistant, [2/19/2026 7:46 PM]
Perfect! Here are the files to paste into Replit:


ðŸ“„ FILE 1: Migration SQL

Create: backend/src/database/migrations/040_property_records.sql

-- Migration 040: Property Records & Sales History
-- Stores scraped property data from county APIs for market research

-- Property records table (main property data)
CREATE TABLE IF NOT EXISTS property_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- Identification
  parcel_id TEXT NOT NULL UNIQUE,
  county TEXT NOT NULL DEFAULT 'Fulton',
  state TEXT NOT NULL DEFAULT 'GA',
  
  -- Address
  address TEXT NOT NULL,
  city TEXT,
  zip_code TEXT,
  
  -- Owner Information
  owner_name TEXT,
  owner_address_1 TEXT,
  owner_address_2 TEXT,
  
  -- Property Characteristics
  units INTEGER,
  land_acres DECIMAL(10, 4),
  year_built TEXT,
  stories INTEGER,
  building_sqft DECIMAL(12, 2),
  
  -- Valuation (current year)
  assessed_value BIGINT,
  assessed_land BIGINT,
  assessed_improvements BIGINT,
  appraised_value BIGINT,
  appraised_land BIGINT,
  appraised_improvements BIGINT,
  
  -- Classification
  land_use_code TEXT,
  class_code TEXT,
  neighborhood_code TEXT,
  subdivision TEXT,
  tax_district TEXT,
  
  -- GIS Data
  parcel_area_sqft DECIMAL(12, 2),
  parcel_perimeter_ft DECIMAL(12, 2),
  
  -- Metadata
  tax_year INTEGER DEFAULT 2025,
  data_source_url TEXT,
  scraped_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Sales history table
CREATE TABLE IF NOT EXISTS property_sales (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  parcel_id TEXT NOT NULL REFERENCES property_records(parcel_id) ON DELETE CASCADE,
  
  -- Sale Details
  sale_year INTEGER NOT NULL,
  sale_price BIGINT NOT NULL,
  
  -- Metadata
  is_current BOOLEAN DEFAULT true,
  scraped_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  
  UNIQUE(parcel_id, sale_year)
);

-- Market trends table (city-level median prices)
CREATE TABLE IF NOT EXISTS market_trends (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  city TEXT NOT NULL,
  year INTEGER NOT NULL,
  median_sale_price BIGINT,
  
  -- Metadata
  scraped_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  
  UNIQUE(city, year)
);

-- Indexes for performance
CREATE INDEX IF NOT EXISTS idx_property_records_parcel_id ON property_records(parcel_id);
CREATE INDEX IF NOT EXISTS idx_property_records_units ON property_records(units);
CREATE INDEX IF NOT EXISTS idx_property_records_county ON property_records(county);
CREATE INDEX IF NOT EXISTS idx_property_records_address ON property_records(address);
CREATE INDEX IF NOT EXISTS idx_property_records_owner ON property_records(owner_name);
CREATE INDEX IF NOT EXISTS idx_property_records_appraised ON property_records(appraised_value);
CREATE INDEX IF NOT EXISTS idx_property_records_neighborhood ON property_records(neighborhood_code);

CREATE INDEX IF NOT EXISTS idx_property_sales_parcel_id ON property_sales(parcel_id);
CREATE INDEX IF NOT EXISTS idx_property_sales_year ON property_sales(sale_year);
CREATE INDEX IF NOT EXISTS idx_property_sales_price ON property_sales(sale_price);

CREATE INDEX IF NOT EXISTS idx_market_trends_city ON market_trends(city);
CREATE INDEX IF NOT EXISTS idx_market_trends_year ON market_trends(year);

-- Computed columns (per-unit metrics)
CREATE OR REPLACE VIEW property_metrics AS
SELECT 
  pr.*,
  CASE 
    WHEN pr.units > 0 THEN pr.assessed_value / pr.units 
    ELSE NULL 
  END AS assessed_per_unit,
  CASE 
    WHEN pr.units > 0 THEN pr.appraised_value / pr.units 
    ELSE NULL 
  END AS appraised_per_unit,
  CASE 
    WHEN pr.units > 0 THEN pr.land_acres / pr.units 
    ELSE NULL 
  END AS acres_per_unit,
  CASE 
    WHEN pr.units > 0 AND pr.building_sqft > 0 THEN pr.building_sqft / pr.units 
    ELSE NULL 
  END AS sqft_per_unit
FROM property_records pr;

-- Grant permissions

Leon AI Assistant, [2/19/2026 7:46 PM]
GRANT SELECT, INSERT, UPDATE, DELETE ON property_records TO authenticated;
GRANT SELECT, INSERT, UPDATE, DELETE ON property_sales TO authenticated;
GRANT SELECT, INSERT, UPDATE, DELETE ON market_trends TO authenticated;
GRANT SELECT ON property_metrics TO authenticated;

COMMENT ON TABLE property_records IS 'Property data scraped from county assessor APIs';
COMMENT ON TABLE property_sales IS 'Sales history for properties (2018-2022)';
COMMENT ON TABLE market_trends IS 'City-level median sale prices (2012-2024) for market context';
COMMENT ON COLUMN property_records.units IS 'Number of living units - critical for multifamily analysis';
COMMENT ON COLUMN property_records.appraised_value IS 'Total appraised value (typically higher than assessed)';
COMMENT ON COLUMN property_records.assessed_value IS 'Total assessed value (used for tax calculation)';


Now run the migration:

cd ~/workspace/jedire
psql $DATABASE_URL -f backend/src/database/migrations/040_property_records.sql


I'll send the import script TypeScript file in the next message (it's long). Ready? ðŸš€