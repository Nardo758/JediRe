Leon AI Assistant, [2/6/2026 9:42 AM]
ðŸŽ¯ Action Items for Replit


1. Database Schema Updates (Both Platforms)

Run this SQL in both databases:

-- Add lease intelligence columns to properties table
ALTER TABLE properties 
ADD COLUMN IF NOT EXISTS lease_expiration_date DATE,
ADD COLUMN IF NOT EXISTS current_lease_amount NUMERIC(10, 2),
ADD COLUMN IF NOT EXISTS lease_start_date DATE,
ADD COLUMN IF NOT EXISTS renewal_status VARCHAR(50);

-- Create index for expiration queries
CREATE INDEX IF NOT EXISTS idx_properties_lease_expiration 
ON properties(lease_expiration_date) 
WHERE lease_expiration_date IS NOT NULL;

-- Create index for renewal status
CREATE INDEX IF NOT EXISTS idx_properties_renewal_status 
ON properties(renewal_status);


2. Apartment Locator AI Updates

A. Update Property Type/Interface (wherever you define property schema)

Add these fields:

lease_expiration_date?: string;  // ISO date
current_lease_amount?: number;
lease_start_date?: string;
renewal_status?: 'renewed' | 'expiring' | 'month_to_month' | 'unknown';

B. Add Negotiation Signal Function (utils or services folder)

// utils/leaseIntel.ts
export function calculateNegotiationPower(property: Property): {
  score: number;  // 0-100
  signal: 'high' | 'medium' | 'low';
  reason: string;
} {
  const expirationDate = property.lease_expiration_date 
    ? new Date(property.lease_expiration_date) 
    : null;
  
  if (!expirationDate) {
    return { score: 0, signal: 'low', reason: 'No lease data available' };
  }

  const daysUntilExpiration = Math.floor(
    (expirationDate.getTime() - Date.now()) / (1000 * 60 * 60 * 24)
  );

  // Within 30 days = high negotiation power
  if (daysUntilExpiration <= 30 && daysUntilExpiration >= 0) {
    return { 
      score: 85, 
      signal: 'high', 
      reason: 'Lease expiring soon - landlord motivated to fill' 
    };
  }

  // Within 60 days = medium
  if (daysUntilExpiration <= 60 && daysUntilExpiration > 30) {
    return { 
      score: 60, 
      signal: 'medium', 
      reason: 'Lease expiring in 2 months - good timing for negotiation' 
    };
  }

  return { score: 20, signal: 'low', reason: 'Lease not expiring soon' };
}

export function calculateBelowMarketGap(
  currentLease: number, 
  marketRate: number
): number {
  return Math.max(0, marketRate - currentLease);
}

C. Display on Property Cards

Add this badge to your property card component:

{property.lease_expiration_date && (
  <div className="mt-2">
    {calculateNegotiationPower(property).signal === 'high' && (
      <span className="inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
        ðŸ’° High Negotiation Power
      </span>
    )}
  </div>
)}


3. JEDI RE Updates

A. Add to Property Search Response (backend API)

When fetching properties in deal boundary, include lease data:

// In your DealsService or PropertiesService
async getPropertiesInBoundary(dealId: string): Promise<Property[]> {
  // Your existing query, just add the new columns:
  const properties = await this.db.query(`
    SELECT 
      p.*,
      p.lease_expiration_date,
      p.current_lease_amount,
      p.lease_start_date,
      p.renewal_status
    FROM properties p
    JOIN deals d ON d.id = $1
    WHERE ST_Contains(d.boundary, ST_Point(p.lng, p.lat))
  `, [dealId]);
  
  return properties.rows;
}

B. Add Rollover Analysis Endpoint (backend)

// In DealsController or new LeaseAnalysisController
@Get(':id/lease-analysis')
async getLeaseAnalysis(@Param('id') dealId: string) {
  const properties = await this.dealsService.getPropertiesInBoundary(dealId);
  
  const now = new Date();
  const next30Days = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
  const next90Days = new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000);
  
  const expiringNext30 = properties.filter(p => 
    p.lease_expiration_date && 
    new Date(p.lease_expiration_date) <= next30Days &&
    new Date(p.lease_expiration_date) >= now
  ).length;

Leon AI Assistant, [2/6/2026 9:42 AM]
const expiringNext90 = properties.filter(p => 
    p.lease_expiration_date && 
    new Date(p.lease_expiration_date) <= next90Days &&
    new Date(p.lease_expiration_date) >= now
  ).length;
  
  const totalUnits = properties.length;
  const rolloverRiskScore = Math.round((expiringNext90 / totalUnits) * 100);
  
  // Calculate rent gap opportunity
  const belowMarketUnits = properties.filter(p => 
    p.current_lease_amount && p.rent && p.current_lease_amount < p.rent
  );
  
  const totalRentGap = belowMarketUnits.reduce((sum, p) => 
    sum + (p.rent - p.current_lease_amount), 0
  );
  
  const annualOpportunity = totalRentGap * 12;
  
  return {
    totalUnits,
    expiringNext30,
    expiringNext90,
    rolloverRiskScore,
    rolloverRiskLevel: rolloverRiskScore > 40 ? 'high' : rolloverRiskScore > 20 ? 'medium' : 'low',
    rentGapOpportunity: {
      unitsBelow: belowMarketUnits.length,
      monthlyGap: Math.round(totalRentGap),
      annualUpside: Math.round(annualOpportunity)
    },
    expirationTimeline: this.buildExpirationTimeline(properties)
  };
}

private buildExpirationTimeline(properties: Property[]) {
  // Group by month for next 12 months
  const timeline = {};
  const now = new Date();
  
  for (let i = 0; i < 12; i++) {
    const monthStart = new Date(now.getFullYear(), now.getMonth() + i, 1);
    const monthEnd = new Date(now.getFullYear(), now.getMonth() + i + 1, 0);
    const monthKey = monthStart.toISOString().slice(0, 7); // "2026-02"
    
    timeline[monthKey] = properties.filter(p => {
      if (!p.lease_expiration_date) return false;
      const expDate = new Date(p.lease_expiration_date);
      return expDate >= monthStart && expDate <= monthEnd;
    }).length;
  }
  
  return timeline;
}

C. Display in Deal Strategy Module (frontend)

Add this section to DealStrategy.tsx:

{/* Lease Rollover Analysis */}
<div className="bg-white rounded-lg shadow p-6 mt-6">
  <h3 className="text-lg font-semibold mb-4">ðŸ“… Lease Rollover Analysis</h3>
  
  <div className="grid grid-cols-3 gap-4 mb-6">
    <div className="text-center">
      <div className="text-3xl font-bold text-blue-600">
        {leaseAnalysis.expiringNext30}
      </div>
      <div className="text-sm text-gray-600">Expiring Next 30 Days</div>
    </div>
    
    <div className="text-center">
      <div className="text-3xl font-bold text-purple-600">
        {leaseAnalysis.expiringNext90}
      </div>
      <div className="text-sm text-gray-600">Expiring Next 90 Days</div>
    </div>
    
    <div className="text-center">
      <div className={`text-3xl font-bold ${
        leaseAnalysis.rolloverRiskScore > 40 ? 'text-red-600' :
        leaseAnalysis.rolloverRiskScore > 20 ? 'text-yellow-600' : 'text-green-600'
      }`}>
        {leaseAnalysis.rolloverRiskScore}%
      </div>
      <div className="text-sm text-gray-600">Rollover Risk Score</div>
    </div>
  </div>
  
  {/* Rent Gap Opportunity */}
  {leaseAnalysis.rentGapOpportunity.annualUpside > 0 && (
    <div className="bg-green-50 border-l-4 border-green-500 p-4 mb-4">
      <div className="flex items-center">
        <div className="text-green-600 mr-2">ðŸ’°</div>
        <div>
          <div className="font-semibold text-green-900">
            ${(leaseAnalysis.rentGapOpportunity.annualUpside / 1000).toFixed(0)}K Annual Upside
          </div>
          <div className="text-sm text-green-700">
            {leaseAnalysis.rentGapOpportunity.unitsBelow} units below market rate 
            (avg ${leaseAnalysis.rentGapOpportunity.monthlyGap} gap/mo)
          </div>
        </div>
      </div>
    </div>
  )}
  
  {/* Expiration Timeline Chart */}
  <div className="text-sm text-gray-600 mb-2">Lease Expirations (Next 12 Months)</div>
  <div className="flex gap-1 h-24 items-end">

Leon AI Assistant, [2/6/2026 9:42 AM]
{Object.entries(leaseAnalysis.expirationTimeline).map(([month, count]) => (
      <div key={month} className="flex-1 flex flex-col items-center">
        <div 
          className="w-full bg-blue-500 rounded-t"
          style={{ height: `${(count / leaseAnalysis.totalUnits) * 100}%` }}
          title={`${month}: ${count} units`}
        />
        <div className="text-xs mt-1 transform -rotate-45 origin-top-left">
          {month.slice(5)}
        </div>
      </div>
    ))}
  </div>
</div>


4. Summary Checklist

In Replit for both platforms:

1. âœ… Run SQL schema updates (add 4 columns to properties table)
2. âœ… Apartment Locator AI:  â€¢ Add lease fields to property TypeScript types
  â€¢ Add leaseIntel.ts utility functions
  â€¢ Add negotiation badge to property cards

3. âœ… JEDI RE:  â€¢ Add lease columns to property query in getPropertiesInBoundary()
  â€¢ Add new endpoint: GET /api/v1/deals/:id/lease-analysis
  â€¢ Add Lease Rollover section to DealStrategy.tsx frontend component
  â€¢ Fetch lease analysis data on Strategy tab load


That's it! All the code you need to add. Once done, you'll have lease intelligence powering both platforms. Want me to clarify any of these steps?